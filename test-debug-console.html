<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Console de Debug - Widget Client</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: #2d2d2d;
            border-radius: 12px;
            border-left: 5px solid #4CAF50;
        }
        .header h1 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        .debug-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .debug-panel {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #007bff;
        }
        .debug-panel h3 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .console-output {
            background: #000;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
        }
        .log-info {
            color: #4CAF50;
        }
        .log-warn {
            color: #FFC107;
        }
        .log-error {
            color: #F44336;
        }
        .log-debug {
            color: #2196F3;
        }
        .config-display {
            background: #000;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            border: 1px solid #333;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-success {
            background: #4CAF50;
            color: white;
        }
        .status-warning {
            background: #FFC107;
            color: black;
        }
        .status-error {
            background: #F44336;
            color: white;
        }
        .diagnostic-section {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #FF9800;
        }
        .diagnostic-section h3 {
            color: #FF9800;
            margin-top: 0;
        }
        .diagnostic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .diagnostic-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            text-align: center;
        }
        .diagnostic-value {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .test-controls {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #9C27B0;
        }
        .test-controls h3 {
            color: #9C27B0;
            margin-top: 0;
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .control-btn {
            background: #9C27B0;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        .control-btn:hover {
            background: #7B1FA2;
        }
        .control-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .real-time-section {
            position: sticky;
            top: 20px;
        }
        .auto-refresh {
            margin: 20px 0;
            text-align: center;
        }
        .refresh-toggle {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        .refresh-toggle.paused {
            background: #F44336;
        }
        .widget-info-display {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #00BCD4;
            grid-column: 1 / -1;
        }
        .widget-info-display h3 {
            color: #00BCD4;
            margin-top: 0;
        }
        @media (max-width: 768px) {
            .debug-grid {
                grid-template-columns: 1fr;
            }
            .control-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Console de Debug Avanc√©</h1>
            <p>Diagnostic en temps r√©el du widget TechNova client</p>
            <p><strong>Code test√© :</strong> data-model="technova" data-theme="red" data-position="bottom-left"</p>
        </div>

        <div class="widget-info-display">
            <h3>üìä √âtat du Widget en Temps R√©el</h3>
            <div class="diagnostic-grid">
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="widget-status">
                        <span class="status-indicator status-warning">CHARGEMENT</span>
                    </div>
                    <div>√âtat du Widget</div>
                </div>
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="model-detected">-</div>
                    <div>Mod√®le D√©tect√©</div>
                </div>
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="theme-detected">-</div>
                    <div>Th√®me D√©tect√©</div>
                </div>
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="position-detected">-</div>
                    <div>Position D√©tect√©e</div>
                </div>
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="api-status">
                        <span class="status-indicator status-warning">TEST</span>
                    </div>
                    <div>API Backend</div>
                </div>
                <div class="diagnostic-item">
                    <div class="diagnostic-value" id="error-count">0</div>
                    <div>Erreurs Console</div>
                </div>
            </div>
        </div>

        <div class="debug-grid">
            <div class="debug-panel">
                <h3>üìù Logs Console en Temps R√©el</h3>
                <div class="console-output" id="console-logs">
                    <div class="log-entry log-info">üîç D√©marrage du monitoring console...</div>
                    <div class="log-entry log-debug">‚è≥ En attente des logs du widget...</div>
                </div>
                <div class="auto-refresh">
                    <button class="refresh-toggle" id="auto-refresh-btn" onclick="toggleAutoRefresh()">
                        üîÑ Auto-refresh ON
                    </button>
                </div>
            </div>

            <div class="real-time-section">
                <div class="debug-panel">
                    <h3>‚öôÔ∏è Configuration D√©tect√©e</h3>
                    <div class="config-display" id="config-display">
                        {
                          "status": "En attente du widget...",
                          "timestamp": "Loading..."
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h3>üîç Diagnostic Automatique</h3>
            <div id="diagnostic-results">
                <div class="log-entry log-info">‚úÖ Monitoring d√©marr√©</div>
                <div class="log-entry log-warn">‚è≥ Attente de l'initialisation du widget...</div>
            </div>
        </div>

        <div class="test-controls">
            <h3>üéÆ Contr√¥les de Test</h3>
            <div class="control-buttons">
                <button class="control-btn" onclick="testWidgetVisibility()">üîç V√©rifier Visibilit√©</button>
                <button class="control-btn" onclick="testWidgetPosition()">üìç V√©rifier Position</button>
                <button class="control-btn" onclick="testWidgetColors()">üé® V√©rifier Couleurs</button>
                <button class="control-btn" onclick="testAPIConnection()">üîó Test API</button>
                <button class="control-btn" onclick="simulateClick()">üñ±Ô∏è Simuler Clic</button>
                <button class="control-btn" onclick="generateReport()">üìã Rapport Complet</button>
                <button class="control-btn" onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
            </div>
        </div>
    </div>

    <!-- ==========================================
         CODE CLIENT EXACT √Ä TESTER
         ========================================== -->
    <script 
        src="https://gkwww04kwcwc00gockw8ocw4.jstr.fr/widget-embed.js"
        data-model="technova"
        data-theme="red"
        data-position="bottom-left">
    </script>

    <script>
        // Variables de monitoring
        let autoRefresh = true;
        let originalConsoleLog = console.log;
        let originalConsoleWarn = console.warn;
        let originalConsoleError = console.error;
        let logEntries = [];
        let errorCount = 0;

        // Interception des logs console
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addLogEntry('info', args.join(' '));
        };

        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addLogEntry('warn', args.join(' '));
        };

        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addLogEntry('error', args.join(' '));
            errorCount++;
            updateErrorCount();
        };

        function addLogEntry(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                type: type,
                message: message,
                timestamp: timestamp
            };
            
            logEntries.push(entry);
            
            // Garder seulement les 50 derniers logs
            if (logEntries.length > 50) {
                logEntries.shift();
            }
            
            if (autoRefresh) {
                updateConsoleDisplay();
            }
        }

        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-logs');
            consoleDiv.innerHTML = '';
            
            logEntries.forEach(entry => {
                const div = document.createElement('div');
                div.className = `log-entry log-${entry.type}`;
                div.innerHTML = `<span style="color: #666;">[${entry.timestamp}]</span> ${entry.message}`;
                consoleDiv.appendChild(div);
            });
            
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function updateErrorCount() {
            document.getElementById('error-count').textContent = errorCount;
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('auto-refresh-btn');
            
            if (autoRefresh) {
                btn.textContent = 'üîÑ Auto-refresh ON';
                btn.className = 'refresh-toggle';
                updateConsoleDisplay();
            } else {
                btn.textContent = '‚è∏Ô∏è Auto-refresh OFF';
                btn.className = 'refresh-toggle paused';
            }
        }

        function testWidgetVisibility() {
            const widget = document.getElementById('technova-embed-widget');
            const diagnostic = document.getElementById('diagnostic-results');
            
            if (widget) {
                diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ Widget trouv√© dans le DOM</div>';
                
                const styles = window.getComputedStyle(widget);
                const isVisible = styles.display !== 'none' && styles.visibility !== 'hidden';
                
                if (isVisible) {
                    diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ Widget visible √† l\'√©cran</div>';
                    document.getElementById('widget-status').innerHTML = '<span class="status-indicator status-success">VISIBLE</span>';
                } else {
                    diagnostic.innerHTML += '<div class="log-entry log-error">‚ùå Widget pr√©sent mais masqu√©</div>';
                    document.getElementById('widget-status').innerHTML = '<span class="status-indicator status-error">MASQU√â</span>';
                }
            } else {
                diagnostic.innerHTML += '<div class="log-entry log-error">‚ùå Widget non trouv√© dans le DOM</div>';
                document.getElementById('widget-status').innerHTML = '<span class="status-indicator status-error">ABSENT</span>';
            }
        }

        function testWidgetPosition() {
            const widget = document.getElementById('technova-embed-widget');
            const diagnostic = document.getElementById('diagnostic-results');
            
            if (widget) {
                const rect = widget.getBoundingClientRect();
                const position = widget.className.includes('bottom-left') ? 'bottom-left' : 
                               widget.className.includes('bottom-right') ? 'bottom-right' :
                               widget.className.includes('top-left') ? 'top-left' :
                               widget.className.includes('top-right') ? 'top-right' : 'unknown';
                
                diagnostic.innerHTML += `<div class="log-entry log-info">üìç Position d√©tect√©e: ${position}</div>`;
                diagnostic.innerHTML += `<div class="log-entry log-debug">üìê Coordonn√©es: bottom: ${window.innerHeight - rect.bottom}px, left: ${rect.left}px</div>`;
                
                document.getElementById('position-detected').textContent = position;
            }
        }

        function testWidgetColors() {
            const bubble = document.querySelector('.technova-embed-bubble');
            const diagnostic = document.getElementById('diagnostic-results');
            
            if (bubble) {
                const styles = window.getComputedStyle(bubble);
                const background = styles.background || styles.backgroundColor;
                
                diagnostic.innerHTML += `<div class="log-entry log-info">üé® Couleur de fond d√©tect√©e: ${background}</div>`;
                
                // V√©rifier si c'est bien rouge (ou contient du rouge)
                const isRedTheme = background.includes('244, 67, 54') || background.includes('#EF4444') || background.includes('rgb(239, 68, 68)');
                
                if (isRedTheme) {
                    diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ Th√®me rouge correctement appliqu√©</div>';
                    document.getElementById('theme-detected').textContent = 'Rouge ‚úÖ';
                } else {
                    diagnostic.innerHTML += '<div class="log-entry log-warn">‚ö†Ô∏è Th√®me rouge non d√©tect√©</div>';
                    document.getElementById('theme-detected').textContent = 'Autre';
                }
            }
        }

        function testAPIConnection() {
            const diagnostic = document.getElementById('diagnostic-results');
            diagnostic.innerHTML += '<div class="log-entry log-info">üîó Test de connexion API en cours...</div>';
            
            // Test basique de l'API
            fetch('https://gkwww04kwcwc00gockw8ocw4.jstr.fr/api/model-info/technova')
                .then(response => {
                    if (response.ok) {
                        diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ API Backend accessible</div>';
                        document.getElementById('api-status').innerHTML = '<span class="status-indicator status-success">OK</span>';
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(data => {
                    diagnostic.innerHTML += `<div class="log-entry log-info">üìä Mod√®le API: ${data.assistantName || 'Non d√©fini'}</div>`;
                    document.getElementById('model-detected').textContent = data.assistantName || 'technova';
                })
                .catch(error => {
                    diagnostic.innerHTML += `<div class="log-entry log-error">‚ùå Erreur API: ${error.message}</div>`;
                    document.getElementById('api-status').innerHTML = '<span class="status-indicator status-error">ERREUR</span>';
                });
        }

        function simulateClick() {
            const bubble = document.querySelector('.technova-embed-bubble');
            const diagnostic = document.getElementById('diagnostic-results');
            
            if (bubble) {
                diagnostic.innerHTML += '<div class="log-entry log-info">üñ±Ô∏è Simulation du clic sur le widget...</div>';
                bubble.click();
                
                setTimeout(() => {
                    const iframe = document.querySelector('.technova-embed-iframe');
                    if (iframe && !iframe.classList.contains('technova-embed-hidden')) {
                        diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ Chat ouvert avec succ√®s</div>';
                    } else {
                        diagnostic.innerHTML += '<div class="log-entry log-error">‚ùå Le chat ne s\'est pas ouvert</div>';
                    }
                }, 500);
            } else {
                diagnostic.innerHTML += '<div class="log-entry log-error">‚ùå Bouton widget non trouv√©</div>';
            }
        }

        function generateReport() {
            const diagnostic = document.getElementById('diagnostic-results');
            diagnostic.innerHTML += '<div class="log-entry log-info">üìã G√©n√©ration du rapport complet...</div>';
            
            // Ex√©cuter tous les tests
            setTimeout(() => testWidgetVisibility(), 100);
            setTimeout(() => testWidgetPosition(), 200);
            setTimeout(() => testWidgetColors(), 300);
            setTimeout(() => testAPIConnection(), 400);
            
            setTimeout(() => {
                diagnostic.innerHTML += '<div class="log-entry log-info">‚úÖ Rapport de diagnostic termin√©</div>';
                updateConfigDisplay();
            }, 1000);
        }

        function updateConfigDisplay() {
            const config = {
                timestamp: new Date().toLocaleString(),
                widget_detected: !!document.getElementById('technova-embed-widget'),
                model: document.getElementById('model-detected').textContent,
                theme: document.getElementById('theme-detected').textContent,
                position: document.getElementById('position-detected').textContent,
                api_status: document.getElementById('api-status').textContent,
                errors: errorCount,
                total_logs: logEntries.length,
                user_agent: navigator.userAgent.substring(0, 50) + '...'
            };
            
            document.getElementById('config-display').textContent = JSON.stringify(config, null, 2);
        }

        function clearLogs() {
            logEntries = [];
            errorCount = 0;
            updateConsoleDisplay();
            updateErrorCount();
            document.getElementById('diagnostic-results').innerHTML = '<div class="log-entry log-info">üóëÔ∏è Logs effac√©s - Monitoring red√©marr√©</div>';
        }

        // Auto-ex√©cution des tests de base au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('üîß Debug Console: D√©marrage des tests automatiques...');
                testWidgetVisibility();
                testWidgetPosition();
                testWidgetColors();
                updateConfigDisplay();
            }, 2000);
            
            // Test p√©riodique
            setInterval(() => {
                if (autoRefresh) {
                    updateConfigDisplay();
                }
            }, 5000);
        });
    </script>
</body>
</html>
