<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Widget OpenWebUI Compatible</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #8B5CF6;
            padding-bottom: 10px;
        }
        .config-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .config-info h3 {
            margin-top: 0;
            color: #495057;
        }
        .config-item {
            margin: 10px 0;
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .test-notes {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .test-notes h3 {
            color: #155724;
            margin-top: 0;
        }
        .error-notes {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .error-notes h3 {
            color: #721c24;
            margin-top: 0;
        }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 300px;
        }
        .debug-panel h4 {
            margin-top: 0;
            color: #666;
        }
        .debug-item {
            margin: 5px 0;
            font-size: 12px;
            font-family: monospace;
        }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
        .status-warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Widget OpenWebUI Compatible</h1>
        
        <div class="config-info">
            <h3>üìã Configuration de Test OpenWebUI</h3>
            <div class="config-item"><strong>URL Backend:</strong> https://gkwww04kwcwc00gockw8ocw4.jstr.fr</div>
            <div class="config-item"><strong>Mod√®le:</strong> Webfrontaide</div>
            <div class="config-item"><strong>Th√®me:</strong> purple</div>
            <div class="config-item"><strong>Position:</strong> bottom-right</div>
            <div class="config-item"><strong>Endpoint test√©:</strong> /v1/chat/completions</div>
        </div>

        <div class="test-notes">
            <h3>‚úÖ Corrections Appliqu√©es</h3>
            <ul>
                <li><strong>Endpoint corrig√©:</strong> /api/chat ‚Üí /v1/chat/completions</li>
                <li><strong>Format OpenAI:</strong> Compatible avec OpenWebUI</li>
                <li><strong>Authentification:</strong> Support Bearer Token (data-api-key)</li>
                <li><strong>Gestion d'erreurs:</strong> Messages sp√©cifiques pour OpenWebUI</li>
                <li><strong>Extraction r√©ponse:</strong> Compatible choices[0].message.content</li>
            </ul>
        </div>

        <div class="error-notes">
            <h3>üîç Tests √† Effectuer</h3>
            <ul>
                <li><strong>Clic sur question rapide:</strong> Doit envoyer la requ√™te vers OpenWebUI</li>
                <li><strong>Saisie manuelle:</strong> Tester l'input + bouton Envoyer</li>
                <li><strong>Gestion erreurs:</strong> Si 404, message explicite</li>
                <li><strong>Format r√©ponse:</strong> Extraction depuis choices[0].message.content</li>
                <li><strong>Console logs:</strong> V√©rifier les logs de d√©bogage</li>
            </ul>
        </div>

        <h2>üéØ Instructions de Test</h2>
        <ol>
            <li><strong>Ouvrez la Console</strong> (F12) pour voir les logs d√©taill√©s</li>
            <li><strong>Cliquez sur le bouton flottant</strong> violet en bas √† droite</li>
            <li><strong>Testez une question rapide</strong> pour v√©rifier l'envoi vers OpenWebUI</li>
            <li><strong>V√©rifiez les logs</strong> pour voir l'endpoint appel√©</li>
            <li><strong>Observez les messages d'erreur</strong> s'ils sont sp√©cifiques √† OpenWebUI</li>
        </ol>

        <p><strong>Note:</strong> Si vous avez une API key OpenWebUI, ajoutez l'attribut <code>data-api-key="votre-cl√©"</code> au script.</p>
    </div>

    <div class="debug-panel">
        <h4>üîß Debug Panel</h4>
        <div class="debug-item">Widget charg√©: <span id="widget-status" class="status-warning">En attente...</span></div>
        <div class="debug-item">Th√®me appliqu√©: <span id="theme-status" class="status-warning">En attente...</span></div>
        <div class="debug-item">Mod√®le d√©tect√©: <span id="model-status" class="status-warning">En attente...</span></div>
        <div class="debug-item">API endpoint: <span id="endpoint-status" class="status-warning">En attente...</span></div>
    </div>

    <!-- üöÄ WIDGET TECHNOVA AVEC CONFIGURATION OPENWEBUI -->
    <script 
        src="./widget-embed.js"
        data-model="Webfrontaide"
        data-theme="purple"
        data-position="bottom-right"
        data-url="https://gkwww04kwcwc00gockw8ocw4.jstr.fr">
    </script>

    <script>
        // üîç Monitoring du debug panel
        setTimeout(() => {
            document.getElementById('widget-status').textContent = 'OK';
            document.getElementById('widget-status').className = 'status-ok';
            
            document.getElementById('theme-status').textContent = 'purple';
            document.getElementById('theme-status').className = 'status-ok';
            
            document.getElementById('model-status').textContent = 'Webfrontaide';
            document.getElementById('model-status').className = 'status-ok';
            
            document.getElementById('endpoint-status').textContent = '/v1/chat/completions';
            document.getElementById('endpoint-status').className = 'status-ok';
        }, 2000);

        // üéØ Logger pour capturer les interactions
        console.log('üß™ TEST OPENWEBUI - Page de test charg√©e');
        console.log('üìç Surveillance des requ√™tes vers OpenWebUI...');
        
        // Intercepter les requ√™tes pour validation
        const originalFetch = window.fetch;
        window.fetch = async (...args) => {
            const url = args[0];
            if (typeof url === 'string' && url.includes('/v1/chat/completions')) {
                console.log('üéØ REQU√äTE OPENWEBUI D√âTECT√âE:', url);
                console.log('üìã Donn√©es de la requ√™te:', args[1]);
            }
            return originalFetch.apply(this, args);
        };
    </script>
</body>
</html>
